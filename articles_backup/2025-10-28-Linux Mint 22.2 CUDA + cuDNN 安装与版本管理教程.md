---
title: "Linux Mint 22.2 CUDA + cuDNN 安装与版本管理教程"
created_at: "2025-10-28 02:22:40"
updated_at: "2025-10-28 09:01:11"
issue_number: 52
labels: ['tips']
url: https://github.com/syaofox/syaofox.github.io/issues/52
---

# Linux Mint 22.2 CUDA + cuDNN 安装与版本管理教程

 **核心理念**：**完全绕过 `apt` 包管理器**  
 - **驱动**：由 **Mint Driver Manager** 安装（官方 `nvidia-driver-580`）
 - **CUDA Toolkit**：使用 **runfile 安装器**（`.run` 文件）
 - **cuDNN**：使用 **.tar 归档**（手动解压）
 - **版本管理**：**项目级 `run.sh` 脚本**（`export` 路径）
 
 **优势**：**零依赖冲突 | Driver Manager 永久正常 | 多版本并存 | 项目 100% 隔离**

---

## **一、准备工作**

```bash
# 更新系统
sudo apt update && sudo apt upgrade -y

# 安装基础工具
sudo apt install -y build-essential gcc g++ make wget curl tar xz-utils
```

检查 GPU：
```bash
lspci | grep -i nvidia
# 确认有 NVIDIA 显卡
```

---

## **二、安装 NVIDIA 驱动（使用 Driver Manager）**

### 图形化安装（**强烈推荐**）

1. 打开 **“驱动程序管理器”**（Driver Manager）
2. 选择 **`nvidia-driver-580`**（或更高，如 550/535）
3. 点击 **“应用更改”**
4. 输入密码 → 等待安装完成 → **重启**

### 命令行验证

```bash
nvidia-smi
# 输出示例：
# Driver Version: 580.95.05   CUDA Version: 13.0
```

> **这一步保证驱动由 Mint 官方源管理，永不被 CUDA 覆盖**

---

## **三、纯手动安装 CUDA Toolkit（runfile 方式）**

### 1. 下载 runfile 安装器

```bash
cd ~/Downloads

# CUDA 13.0（推荐）
wget https://developer.download.nvidia.com/compute/cuda/13.0.1/local_installers/cuda_13.0.1_530.30.02_linux.run

# CUDA 12.6（可选，旧项目）
wget https://developer.download.nvidia.com/compute/cuda/12.6.0/local_installers/cuda_12.6.0_560.28.03_linux.run
```

> **其他版本**：访问 [CUDA Toolkit Archive](https://developer.nvidia.com/cuda-toolkit-archive)

### 2. 进入 TTY（安全模式）

```bash
# 切换到 TTY3
Ctrl + Alt + F3

# 登录
username: syaofox
password: [你的密码]
```

### 3. 停止图形界面

```bash
sudo systemctl isolate multi-user.target
# 或
sudo pkill -f Xorg
```

### 4. 运行安装器（**仅安装 Toolkit**）

```bash
# 安装 CUDA 13.0
sudo sh cuda_13.0.1_530.30.02_linux.run \
  --toolkit \
  --toolkitpath=/usr/local/cuda-13.0 \
  --no-opengl-libs \
  --override

# 安装 CUDA 12.6（可选）
sudo sh cuda_12.6.0_560.28.03_linux.run \
  --toolkit \
  --toolkitpath=/usr/local/cuda-12.6 \
  --no-opengl-libs \
  --override
```

> **安装过程**：
> 1. 按 `q` 跳过协议
> 2. 按 `y` 接受 EULA
> 3. **用空格键取消勾选 `Driver`**（只保留 `CUDA Toolkit`）
> 4. 按 `Enter` 确认

### 5. 恢复图形界面

```bash
sudo systemctl start graphical.target
# 或 Ctrl+Alt+F1 回到桌面
```


### 一键安全安装脚本（自动处理 TTY）

```bash
nano ~/install_cuda_safe.sh
```

```bash
#!/bin/bash
# 安全 runfile 安装（自动停止/恢复 GUI）

RUNFILE="$1"
TARGET="$2"

[[ -z "$RUNFILE" || -z "$TARGET" ]] && {
    echo "用法: $0 cuda_13.0.1_530.30.02_linux.run /usr/local/cuda-13.0"
    exit 1
}

# 1. 停止 GUI
echo "停止图形界面..."
sudo systemctl isolate multi-user.target

# 2. 安装
echo "开始安装 $RUNFILE → $TARGET"
sudo sh "$RUNFILE" --toolkit --toolkitpath="$TARGET" --no-opengl-libs --override

# 3. 恢复 GUI
echo "恢复图形界面..."
sudo systemctl start graphical.target

echo "安装完成！请重启验证：nvidia-smi"
```

```bash
chmod +x ~/install_cuda_safe.sh
~/install_cuda_safe.sh ~/Downloads/cuda_13.0.1_530.30.02_linux.run /usr/local/cuda-13.0
```

[install_cuda_safe.sh](https://github.com/user-attachments/files/23182995/install_cuda_safe.sh)

---

## **四、纯手动安装 cuDNN（.tar 方式）**

### 1. 下载 cuDNN .tar 文件（需 NVIDIA 账号）

1. 登录 [NVIDIA Developer](https://developer.nvidia.com/)
2. 访问 [cuDNN 下载页面](https://developer.nvidia.com/cudnn-downloads)
3. 选择：
   - **OS**: Linux
   - **Architecture**: x86_64
   - **CUDA Version**: 13.0
   - **Package**: **Tarball and Zip Archive Deliverables**
4. 下载：`cudnn-linux-x86_64-9.14.0_cuda13-archive.tar.xz`

```bash
cd ~/Downloads
wget https://developer.download.nvidia.com/compute/cudnn/redist/cudnn/linux-x86_64/cudnn-linux-x86_64-9.14.0_cuda13-archive.tar.xz
```

### 2. 解压并复制到对应 CUDA 目录

```bash
# 解压
tar -xvf cudnn-linux-x86_64-9.14.0_cuda13-archive.tar.xz

# 复制到 CUDA 13.0
sudo cp cudnn-*-archive/include/cudnn*.h /usr/local/cuda-13.0/include/
sudo cp -P cudnn-*-archive/lib/libcudnn* /usr/local/cuda-13.0/lib64/
sudo chmod a+r /usr/local/cuda-13.0/lib64/libcudnn*

# 更新库缓存
sudo ldconfig
```

> **CUDA 12.6 cuDNN**：下载 `cudnn-linux-x86_64-9.0.0_cuda12-archive.tar.xz`，复制到 `/usr/local/cuda-12.6`

---

## **五、项目级隔离（纯 `run.sh` 手动 `export`）**

> **不创建 `/usr/local/cuda` 符号链接**，避免系统污染

### 目录结构

```bash
~/projects/
├── ml_model_13/        # 用 CUDA 13.0
│   └── run.sh
├── legacy_app_12/      # 用 CUDA 12.6
│   └── run.sh
└── cpu_task/           # 无 GPU
    └── run.sh
```

### 1. `ml_model_13/run.sh`（CUDA 13.0）

```bash
#!/bin/bash
# 项目：ml_model_13 → 强制使用 CUDA 13.0

# 清理旧路径
unset CUDA_HOME
export PATH=$(echo $PATH | tr ':' '\n' | grep -v "/cuda" | tr '\n' ':' | sed 's/:$//')
export LD_LIBRARY_PATH=$(echo $LD_LIBRARY_PATH | tr ':' '\n' | grep -v "/cuda" | tr '\n' ':' | sed 's/:$//')

# 手动指定 CUDA 13.0
export CUDA_HOME=/usr/local/cuda-13.0
export PATH=$CUDA_HOME/bin:$PATH
export LD_LIBRARY_PATH=$CUDA_HOME/lib64:$LD_LIBRARY_PATH

echo "项目 ml_model_13 → CUDA 13.0 已激活"
nvcc --version | head -n 2

# 你的代码
python3 train.py
```

### 2. `legacy_app_12/run.sh`（CUDA 12.6）

```bash
#!/bin/bash
unset CUDA_HOME
export PATH=$(echo $PATH | tr ':' '\n' | grep -v "/cuda" | tr '\n' ':' | sed 's/:$//')
export LD_LIBRARY_PATH=$(echo $LD_LIBRARY_PATH | tr ':' '\n' | grep -v "/cuda" | tr '\n' ':' | sed 's/:$//')

export CUDA_HOME=/usr/local/cuda-12.6
export PATH=$CUDA_HOME/bin:$PATH
export LD_LIBRARY_PATH=$CUDA_HOME/lib64:$LD_LIBRARY_PATH

echo "项目 legacy_app_12 → CUDA 12.6 已激活"
nvcc --version | head -n 2

python3 old_script.py
```

### 3. `cpu_task/run.sh`（禁用 GPU）

```bash
#!/bin/bash
unset CUDA_HOME CUDA_VISIBLE_DEVICES
export PATH=$(echo $PATH | tr ':' '\n' | grep -v "/cuda" | tr '\n' ':' | sed 's/:$//')
export LD_LIBRARY_PATH=$(echo $LD_LIBRARY_PATH | tr ':' '\n' | grep -v "/cuda" | tr '\n' ':' | sed 's/:$//')

echo "GPU 已禁用"
python3 cpu_only.py
```

### 使用方法

```bash
cd ~/projects/ml_model_13
chmod +x run.sh
./run.sh
```

---

## **六、验证安装**

```bash
# 重启系统
sudo reboot
```

### 1. 验证驱动（Mint 官方）

```bash
nvidia-smi
# Driver Version: 580.95.05   CUDA Version: 13.0
```

### 2. 验证 CUDA Toolkit

```bash
/usr/local/cuda-13.0/bin/nvcc --version
# release 13.0
```

### 3. 验证样本程序

```bash
# 复制样本
cp -r /usr/local/cuda-13.0/samples ~/cuda-samples
cd ~/cuda-samples/1_Utilities/deviceQuery
make && ./deviceQuery
# 输出: Result = PASS
```

### 4. 验证 cuDNN

```bash
# 下载样本（可选）
wget https://developer.nvidia.com/compute/cudnn/secure/9.14.0/local_installers/13.0/cudnn-linux-x86_64-9.14.0_cuda13-archive.tar.xz
# 或使用 runfile 自带样本
cd /usr/local/cuda-13.0/samples/7_CUDALibraries/mnistCUDNN
make && ./mnistCUDNN
# 输出: Test passed!
```

---

## **七、框架安装（在 `run.sh` 中）**

```bash
# PyTorch CUDA 13.0
pip install torch torchvision torchaudio --index-url https://download.pytorch.org/whl/cu130

# PyTorch CUDA 12.6
pip install torch torchvision torchaudio --index-url https://download.pytorch.org/whl/cu126

# TensorFlow
pip install tensorflow[and-cuda]
```

---

## **八、卸载**

```bash
# 卸载 CUDA
sudo rm -rf /usr/local/cuda-13.0 /usr/local/cuda-12.6

# 卸载驱动（图形化）
# Driver Manager → 选择 “使用 nouveau 驱动” → 应用 → 重启
```

---

## **九、最终目录结构**

```
/usr/local/
├── cuda-13.0/          # runfile 安装
├── cuda-12.6/          # runfile 安装
~/projects/
├── ml_model_13/run.sh  # export cuda-13.0
├── legacy_app_12/run.sh# export cuda-12.6
└── cpu_task/run.sh     # unset CUDA
```

---

## **总结：纯手动安装 = 最安全方案**

| 项目 | 安装方式 | 管理方式 |
|------|----------|----------|
| **驱动** | Driver Manager | 官方 `nvidia-driver-580` |
| **CUDA** | runfile `.run` | `--toolkit` + 独立路径 |
| **cuDNN** | `.tar.xz` | 手动解压复制 |
| **版本切换** | 项目 `run.sh` | `export CUDA_HOME=...` |

---

**完结！**  
你现在拥有：
- **Driver Manager 永久正常**
- **驱动永不被覆盖**
- **CUDA 多版本任意切换**
- **项目 100% 隔离**
- **系统更新零风险**

> **以后所有 CUDA 都用 runfile + .tar 安装，永别 `apt` 依赖地狱！**

