---
title: "Linux Mint 22.2 Btrfs + 交换文件 全新安装流程"
created_at: "2025-10-15 09:27:55"
updated_at: "2025-10-15 09:27:55"
issue_number: 27
labels: ['tips']
url: https://github.com/syaofox/syaofox.github.io/issues/27
---

# Linux Mint 22.2 Btrfs + 交换文件 全新安装流程

这个流程是基 Linux Mint 22.2 安装程序**会自动创建 `@` 和 `@home` 子卷**而定制的最优化方案，它确保了在 Btrfs 上使用 **Timeshift** 快照功能，同时配置了**易于管理和调整大小**的交换文件。

- - -

## **Linux Mint 22.2 Btrfs + 交换文件 全新安装流程**

### **第一部分：安装前的准备和分区**

1.  **准备安装介质：** 下载 Linux Mint 22.2 ISO 文件，并使用 Rufus 或 Ventoy 等工具制作一个可启动的 USB 驱动器。
    
2.  **启动 Live Session：** 从 USB 驱动器启动电脑，选择进入 **Linux Mint Live** 环境。
    
3.  **运行分区工具（GParted）：** 打开 GParted，对目标硬盘进行分区。
    

| 分区类型 | 大小（建议） | 文件系统 | 标志 (Flags) | 挂载点（用于安装程序） | 作用 |
| :--- | :--- | :--- | :--- | :--- | :--- |
| **EFI 系统分区 (ESP)** | 512MB ~ 1GB | FAT32 | boot, esp | **/boot/efi** | UEFI 启动所需 |
| **Btrfs 主分区** | 剩余所有空间 | btrfs | 无 | **/** | 系统和所有用户数据 |


> **提示：** 这一步**不需要**创建独立的交换分区（Swap Partition）。

- - -

### **第二部分：运行 Linux Mint 安装程序**

1.  **启动安装程序：** 双击桌面上的 **Install Linux Mint** 图标。
    
2.  **选择语言、键盘布局、是否安装多媒体解码器**，然后继续。
    
3.  **选择安装类型：** 在分区步骤，选择 **Something else**（其他选项）进行手动配置。
    
4.  **配置分区挂载点：**
    
    *   找到您创建的 **FAT32 分区**：双击它，选择 **Use as:** `EFI System Partition`，挂载点为 **`/boot/efi`**。
        
    *   找到您创建的 **Btrfs 分区**：双击它，选择 **Use as:** `Btrfs journaling file system`，**勾选 Format**，挂载点为 **`/`** (根目录)。
        
5.  **开始安装：** 检查引导加载程序安装位置是否正确（通常是您要安装的硬盘，如 `/dev/sda` 或 `/dev/nvme0n1`），然后点击 **Install Now**。
    
6.  完成用户、密码、时区等设置，等待安装完成。
    

- - -

### **第三部分：配置 Btrfs 交换文件（关键步骤）**

安装完成后，**不要重启**。选择 **Continue Testing**（继续测试），然后打开**终端**。

#### **1\. 检查和准备工作**

首先，验证 Btrfs 根文件系统的 **UUID**，并确保您在根目录上操作（`/` 已经由安装程序挂载）。

```bash
# 获取 Btrfs 根文件系统的 UUID
BTRFS_UUID=$(findmnt -no UUID /)
echo "您的 Btrfs UUID 是: $BTRFS_UUID"

# 检查根目录下的子卷（确认安装程序已创建 @ 和 @home）
sudo btrfs subvolume list /
# 预期您会看到类似 ID ... path @ 和 ID ... path @home 的输出
```

#### **2\. 创建 `@swap` 子卷和挂载点**

为了不影响 Timeshift 快照，交换文件必须位于一个独立的子卷 `@swap` 中。


```bash
# 1. 创建 /swap 目录作为 @swap 子卷的挂载点
sudo mkdir -p /swap

# 2. 在 Btrfs 文件系统的顶级路径下创建新的子卷 @swap
# 注意：路径是 /@swap，它将在 / 下创建
sudo btrfs subvolume create /@swap

# 3. 将 @swap 子卷挂载到 /swap 目录
# 使用前面获取的 BTRFS_UUID
sudo mount -o subvol=@swap,defaults,noatime,compress=no UUID=$BTRFS_UUID /swap
```

#### **3\. 创建并启用交换文件**

我们使用 `btrfs filesystem mkswapfile` 命令，它会自动处理必要的 **NODATACOW** 属性和预分配。


```bash
# 1. 创建并初始化 8GB 交换文件
# 您可以根据内存大小调整 8G 的值，例如 4G 或 16G
sudo btrfs filesystem mkswapfile --size 8G /swap/swapfile

# 2. 启用交换文件
sudo swapon /swap/swapfile

# 3. 验证交换文件是否成功启用
swapon --show
```

#### **4\. 更新 /etc/fstab 文件**

为了确保交换功能在每次启动时都能自动启用，必须修改 `/etc/fstab`。


```bash
sudo nano /etc/fstab
```

在文件的**末尾**添加以下两行：

代码段

```
# Btrfs Swap Subvolume - 挂载 @swap 子卷到 /swap 目录
UUID=$BTRFS_UUID /swap           btrfs   subvol=@swap,defaults,noatime,compress=no 0 0

# Swap File - 启用交换文件
/swap/swapfile none swap defaults 0 0
```

> **注意：** 务必将上述 `$BTRFS_UUID` 替换为您实际获取的 UUID。

保存并关闭文件（在 `nano` 中按 `Ctrl+O` 保存，`Ctrl+X` 退出）。

- - -

### **第四部分：完成和首次启动**

1.  **卸载 Live 环境挂载点（可选，但推荐）：**
    
        
    ```bash
    sudo umount -R /swap
    # 理论上 / 根文件系统由 Live Session 挂载，但重启时会自动处理
    ```
    
2.  **重启系统：**
    
        
    ```bash
    reboot
    ```
    
3.  **首次启动后验证：** 进入新安装的 Linux Mint 系统，打开终端，运行 `free -h`。确认 **Swap** 行显示为您设置的交换文件大小，即表示配置成功。
    

这个流程结合了 Linux Mint 自动创建子卷的便利性，并为您手动完成了 Btrfs 交换文件所需的唯一复杂配置。

